name = "taplock-worker"
main = "worker/src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Static assets serving (frontend SPA)
[assets]
directory = "./public"
not_found_handling = "single-page-application"
run_worker_first = ["/api/*"]

# =============================================================================
# Production Environment (default)
# =============================================================================

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "taplock-db"
database_id = ""  # Auto-generated during deployment
migrations_dir = "worker/drizzle"

# Environment variables
# Note: JWT_SECRET should be set via `npx wrangler secret put JWT_SECRET`
[vars]
RP_ID = "taplock-worker.workers.dev"  # Update to your custom domain if needed
RP_NAME = "TapLock"

# =============================================================================
# Preview Environment (for PR deployments)
# =============================================================================
[env.preview]
name = "taplock-worker-preview"

[[env.preview.d1_databases]]
binding = "DB"
database_name = "taplock-db-preview"
database_id = ""  # Auto-generated during deployment
migrations_dir = "worker/drizzle"

[env.preview.vars]
RP_ID = "taplock-worker-preview.workers.dev"
RP_NAME = "TapLock Preview"
